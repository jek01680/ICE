<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mybatis.mapper.oracle.resource">

	<!-- 자원관리 -->
	<select id="selectResManage" parameterType="ResManageSearchVO" resultType="resManageVo">
	select * from(
		select rownum as RNUM, A.*
		from (
		   	select * from v_resmanage
		    order by resname
		)A
	)
	<![CDATA[ 
	where RNUM > #{firstRecordIndex}
	 and RNUM <= #{firstRecordIndex } + #{recordCountPerPage}]]>
	</select>
	
	<select resultType="int" id="selectTotalRecord">
		select count(*) from v_resmanage 
	</select>
	
	<select id="selectResKind" resultType="resKindVo">
		select * from resKind
	</select>
	
	<insert id="insertResManage" parameterType="resManagevo">
	insert into resmanage(resno, resname, resimage, ressize, reslocation, resoriginalimage, rkNo, ressubdesc)
	values(resno_seq.nextval, #{resName}, #{resImage}, #{resSize}, #{resLocation}, #{resOriginalImage}, #{rkNo}, #{resSubdesc})
	</insert>
	<select id="selectResManageOne" parameterType="int" resultType="resManageVo">
		select * from v_resManage 
		where resNo=#{resNo}
	</select>
	<update id="updateResource" parameterType="resManageVo">
		update resmanage
		set resname=#{resName}
		<if test="resImage!=null and resImage!=''">
		, resimage=#{resImage}, ressize=#{resSize}, resoriginalimage=#{resOriginalImage}
		</if>
		, reslocation=#{resLocation}, ressubdesc=#{resSubdesc}, rkNo=#{rkNo}
		where resno=#{resNo}
	</update>
	<delete parameterType="int" id="deleteResManage">
		delete from resmanage where resNo=#{resNo} 
	</delete>
	
	
	<!-- 자원예약 -->
	<select id="selectReserveResNo" parameterType="int" resultType="resReserveVo">
		select * from v_resreserve
		where resno=#{resNo}
	</select>
	<select id="selectReserveKind" parameterType="int" resultType="resKindVo">
		select * from reskind
		where rkno=#{rkNo}
	</select>
	<select id="selectAvailableHour" parameterType="resReserveVo" resultType="resReserveVo">
		select * from
		    (
		    select rvno, resno, rvstart, rvend 
		    from v_resreserve
		    <![CDATA[ 
		    where (rvstart > to_date(#{startDate}, 'YYYY-MM-DD') and rvstart < to_date(#{startDate}, 'YYYY-MM-DD') + 1)
		    or (rvstart > to_date(#{startDate}, 'YYYY-MM-DD')-1 and rvend < to_date(#{startDate}, 'YYYY-MM-DD') + 1) ]]>
		    )
		where resno=#{resNo}
		order by rvstart
	</select>
</mapper>